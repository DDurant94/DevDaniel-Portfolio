/**
 * Workflow Steps - Staggered reveal animations with alternating layout
 */

/**
 * Components:
 * - #about-workflows-container: Outer wrapper
 * - #workflow-steps-container: List container with pseudo-element background
 * - .workflow-step: Individual step items
 * - .workflow-step-header: Step heading wrapper
 * - .workflow-step-h3: Heading with animated underline (::after)
 * - .left/.right: Alignment modifiers
 * 
 * Animation System:
 * - Stagger timing: --wf-stagger (70ms base)
 * - Underline extra delay: --wf-underline-extra (60ms)
 * - Step-specific delay: calc(--wf-stagger * --_i)
 * - Opacity fade: var(--motion-fade, 220ms)
 * - Transform slide: var(--motion-panel-enter, 360ms)
 * 
 * Custom Properties:
 * - --wf-stagger: Base stagger interval (70ms)
 * - --wf-underline-extra: Additional underline delay (60ms)
 * - --wf-underline-move-dur: Underline slide duration (420ms)
 * - --wf-underline-opacity-dur: Underline fade duration (140ms)
 * - --wf-underline-opacity-advance: Underline opacity lead time (80ms)
 * - --_i: Step index for stagger calculation
 * - --_wf-x: Horizontal offset (0 mobile, ±160px desktop)
 * - --_step-delay: Computed step delay
 * - --_underline-delay: Computed underline delay
 * 
 * Initial State:
 * - opacity: 0 (hidden)
 * - transform: translate(var(--_wf-x), 12px) scale(.975)
 * - --_wf-x: 0 on mobile
 * - --_wf-x: -160px (.left on desktop)
 * - --_wf-x: 160px (.right on desktop)
 * 
 * Revealed State (via JS):
 * - opacity: 1 (visible)
 * - transform: translate(0, 0) scale(1)
 * - Animated with computed delays
 * 
 * Background Effect:
 * - #workflow-steps-container::before pseudo-element
 * - radial-gradient: 8% primary color at center
 * - 80% width, 100% height
 * - Centered with left: 50%, transform: translateX(-50%)
 * - z-index: -1 (behind steps)
 * 
 * Underline Animation:
 * - .workflow-step-h3::after pseudo-element
 * - 2px height, 100% width
 * - background: var(--gradient-brand-horizontal)
 * - Initial: opacity 0, scaleX(0), transform-origin left
 * - Revealed: opacity 1, scaleX(1)
 * - Separate timing for opacity vs. transform
 * 
 * Layout:
 * - .left steps: margin-right auto, align-self flex-start
 * - .right steps: margin-left auto, align-self flex-end
 * - Full width on mobile, offset on desktop
 * - box-sizing: border-box
 * - padding: 0.5rem, margin: 2rem 0
 * 
 * Typography:
 * - .workflow-header h2: calc(1.775rem + 1vw)
 * - .workflow-step-h3: calc(1.175rem + 0.9vw), font-weight 600
 * - .workflow-transition: 1.2rem, font-weight 500
 * - #workflow-desc: var(--font-size-lg)
 * - p: line-height var(--line-height-loose), 1.1rem
 * 
 * Responsive Behavior:
 * - Mobile (< 768px): No horizontal slide (--_wf-x: 0)
 * - Desktop (≥ 768px): ±160px horizontal offset
 * - Steps alternate left/right for visual rhythm
 * 
 * Accessibility:
 * - list-style: none (semantic <ol> with custom styling)
 * - Step index available via --_i for stagger calculation
 * - Reduced motion not yet implemented (consider @media prefers-reduced-motion)
 * 
 * Performance:
 * - transform and opacity animations (GPU accelerated)
 * - will-change hints recommended for steps
 * - Pseudo-element for background (avoids extra DOM)
 * - Stagger delays prevent simultaneous animations
 * 
 * Browser Compatibility:
 * - CSS custom properties: All modern browsers
 * - color-mix(): Recent browsers (Safari 16.4+, Chrome 111+)
 * - Gradient background-clip: Widely supported
 * - scale() in transform: Universal support
 * 
 * @layer components
 * @requires Motion tokens, color tokens, gradient definitions
 */

#about-workflows-container {
  position: relative;
}

#workflow-steps-container {  
  position: relative;
  list-style: none;
  padding: 0;
  margin: 0;
  --wf-stagger: var(--motion-stagger-sm, 70ms);
  --wf-underline-extra: var(--motion-stagger-xxs, 60ms);
  --wf-underline-move-dur: var(--motion-duration-md, 420ms);
  --wf-underline-opacity-dur: var(--motion-duration-sm, 140ms);
  --wf-underline-opacity-advance: var(--motion-stagger-xxs, 80ms);
}

#workflow-steps-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 80%;
  background: radial-gradient(circle at center, color-mix(in srgb, var(--color-primary) 8%, transparent), transparent 70%);
  z-index: -1;
}

.workflow-header h2 {
  font-size: calc(1.775rem + 1vw);
}

#workflow-desc{
  font-size: var(--font-size-lg);
  margin-top: 0.5rem;
}

.workflow-step {
  box-sizing: border-box;
  overflow: hidden;
  padding: var(--gap-sm);
  margin: var(--gap-lg) 0;
  opacity: 0;
  --_wf-x: 0;
  --_i: var(--_i, 0);
  --_step-delay: calc(var(--wf-stagger, 70ms) );
  --_underline-delay: calc(var(--wf-stagger, 70ms) + var(--wf-underline-extra, 60ms));
  /* Use translateX/Y separately for better browser support */
  transform: translateX(var(--_wf-x)) translateY(12px) scale(.975);
  transition:
    opacity var(--motion-fade, 220ms var(--ease-standard, cubic-bezier(.2,0,0,1))) var(--_step-delay),
    transform var(--motion-panel-enter, 360ms var(--ease-emphasis, cubic-bezier(.2,0,0,1))) var(--_step-delay);

    p{
      line-height: var(--line-height-loose);
      font-size: 1.1rem;
    }
}

.workflow-step.left { margin-right: auto; margin-left: 0.25rem; align-self: flex-start; --_wf-x: -80px; }
.workflow-step.right { margin-left: auto; margin-right: 0.25rem; align-self: flex-end; --_wf-x: 80px; }

@media (min-width: 768px) {
  .workflow-step.left { --_wf-x: -160px; }
  .workflow-step.right { --_wf-x: 160px; }
}

.workflow-step-header { position: relative; display: inline-block; }
.workflow-step-h3 { font-size: calc(1.175rem + 0.9vw); margin-bottom: 0.5rem; position: relative; font-weight: 600; }
.workflow-transition { font-size: 1.2rem; font-weight: 500; }

.workflow-step-h3::after {
  content: '';
  position: absolute;
  left: 0; bottom: 0;
  height: 2px; width: 100%;
  background: var(--gradient-brand-horizontal, linear-gradient(90deg, var(--color-primary, #6cf) 0%, var(--color-accent, #f6c) 100%));
  transform: translateX(var(--_underline-shift, 0)) scaleX(0);
  transform-origin: var(--_underline-origin, left) center;
  transition:
    transform var(--wf-underline-move-dur, 420ms) var(--ease-standard, cubic-bezier(.2,0,0,1)) var(--_underline-delay),
    opacity var(--wf-underline-opacity-dur, 140ms) var(--ease-standard, cubic-bezier(.2,0,0,1)) max(0s, calc(var(--_underline-delay) - var(--wf-underline-opacity-advance, 80ms)));
  opacity: 0;
  background-size: 200% 100%;
  background-position: 0% 50%;
  will-change: transform, opacity, background-position;
  pointer-events: none;
}

.workflow-step-header > .underline {
  position: absolute;
  left: 0; bottom: 0;
  height: 2px; width: 100%;
  background: var(--gradient-brand-horizontal);
  transform: translateX(var(--_underline-shift, 0)) scaleX(0);
  transform-origin: var(--_underline-origin, left) center;
  transition:
    transform var(--wf-underline-move-dur, 420ms) var(--ease-standard, cubic-bezier(.2,0,0,1)) var(--_underline-delay),
    opacity var(--wf-underline-opacity-dur, 140ms) var(--ease-standard, cubic-bezier(.2,0,0,1)) max(0s, calc(var(--_underline-delay) - var(--wf-underline-opacity-advance, 80ms)));
  opacity: 0;
  pointer-events: none;
}

.workflow-step.left .workflow-step-h3::after {
  --_underline-origin: left;
  --_underline-shift: -16%;
}
.workflow-step.right .workflow-step-h3::after {
  --_underline-origin: right;
  --_underline-shift: 16%;
}

.workflow-step.is-visible { opacity: 1; transform: translateX(0) translateY(0) scale(1); }
.workflow-step.is-visible .workflow-step-h3::after,
.workflow-step.is-visible .workflow-step-header > .underline {
  transform: translateX(0) scaleX(1);
  opacity: 1;
}

.workflow-step-h3.is-visible::after { transform: translateX(0) scaleX(1); opacity: 1; }

@keyframes workflow-underline-shimmer {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.workflow-step.is-active .workflow-step-h3::after {
  height: 3px;
  filter: drop-shadow(0 0 4px color-mix(in srgb,var(--color-primary) 70%, transparent));
  transform: translateX(0) scaleX(1);
  opacity: 1;
  animation: workflow-underline-shimmer 2.2s var(--ease-standard, cubic-bezier(.2,0,0,1)) infinite;
}

.workflow-step:hover .workflow-step-h3::after,
.workflow-step:focus-within .workflow-step-h3::after {
  height: 1.5px;
  animation: workflow-underline-shimmer 2.2s var(--ease-standard, cubic-bezier(.2,0,0,1)) infinite;
}

.workflow-step.is-active .workflow-step-header > .underline {
  transform: translateX(0) scaleX(1);
  opacity: 1;
  animation: workflow-underline-shimmer 2.2s var(--ease-standard, cubic-bezier(.2,0,0,1)) infinite;
}

@media (max-width: 640px) {
  .workflow-step.left .workflow-step-h3::after { --_underline-shift: -8%; }
  .workflow-step.right .workflow-step-h3::after { --_underline-shift: 8%; }
}

#workflow-steps-container > .workflow-step:nth-child(1),
#workflow-steps-container > .workflow-step:nth-child(2) { --_i: 0; }
#workflow-steps-container > .workflow-step:nth-child(3),
#workflow-steps-container > .workflow-step:nth-child(4) { --_i: 1; }

/* ===========================
   SCROLL PERFORMANCE OPTIMIZATION
   Pause infinite animations during scroll to prevent paint thrashing
   =========================== */
[data-scrolling="true"] .workflow-step-h3::after,
[data-scrolling="true"] .workflow-step-header > .underline {
  animation-play-state: paused !important;
}
#workflow-steps-container > .workflow-step:nth-child(5),
#workflow-steps-container > .workflow-step:nth-child(6) { --_i: 2; }
#workflow-steps-container > .workflow-step:nth-child(7),
#workflow-steps-container > .workflow-step:nth-child(8) { --_i: 3; }

#workflow-steps-container > li.workflow-step:nth-of-type(1),
#workflow-steps-container > li.workflow-step:nth-of-type(2) { --_i: 0; }
#workflow-steps-container > li.workflow-step:nth-of-type(3),
#workflow-steps-container > li.workflow-step:nth-of-type(4) { --_i: 1; }
#workflow-steps-container > li.workflow-step:nth-of-type(5),
#workflow-steps-container > li.workflow-step:nth-of-type(6) { --_i: 2; }
#workflow-steps-container > li.workflow-step:nth-of-type(7),
#workflow-steps-container > li.workflow-step:nth-of-type(8) { --_i: 3; }

/* ===========================
   ACTIVE STEP PULSE ANIMATION
   =========================== */
@keyframes workflow-pulse { 0%,100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.0); } 50% { box-shadow: 0 0 0 4px color-mix(in srgb,var(--color-primary) 55%, transparent); } }
.workflow-step.is-active { animation: workflow-pulse var(--motion-duration-lg) var(--ease-emphasis) 1; }

@media (prefers-reduced-motion: reduce) {
  .workflow-step.is-active {
    animation: none;
  }
  
  .workflow-step::before {
    animation: none;
  }
}

.workflow-step:focus {
  outline: none;
}

.workflow-step:focus-visible {
  outline: var(--shadow-focus-ring);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-focus-ring);
}

@media (min-width: 768px) {
  .workflow-step.left,
  .workflow-step.right {
    max-width: 48%;
  }
}


